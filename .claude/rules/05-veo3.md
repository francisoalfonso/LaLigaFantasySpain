# VEO3 Rules - Fantasy La Liga Pro

Reglas espec√≠ficas para el sistema VEO3 de generaci√≥n de videos con Ana.

## üî¥ REGLAS CR√çTICAS VEO3

### 1. Ana Character Consistency - INQUEBRANTABLE

**NUNCA CAMBIAR ESTOS VALORES:**

```javascript
// ‚ùå NUNCA MODIFICAR
const ANA_CHARACTER_SEED = 30001;
const ANA_IMAGE_URL = 'https://raw.githubusercontent.com/laligafantasyspainpro-ux/imagenes-presentadores/main/ana-main/Ana-001.jpeg';
```

**Por qu√© es cr√≠tico:**
- Seed 30001 garantiza consistencia visual de Ana
- Imagen URL fija mantiene referencia estable
- Cambiar cualquiera rompe la identidad del personaje

### 2. Prompts Optimizados - PATR√ìN OBLIGATORIO

**Estructura correcta (30-50 palabras m√°ximo):**

```javascript
// ‚úÖ CORRECTO - Patr√≥n que funciona
const prompt = `The person from the reference image speaks in Spanish from Spain: "${dialogue}". Maintain the exact appearance and style from the reference image.`;
```

**Elementos obligatorios:**
1. **Sujeto**: "The person from the reference image"
2. **Acci√≥n**: "speaks in Spanish from Spain" (lowercase)
3. **Di√°logo**: `"${dialogue}"`
4. **Preservaci√≥n**: "Maintain the exact appearance and style from the reference image"

### 3. Espa√±ol de Espa√±a - CR√çTICO

**Problema**: VEO3 puede generar acento mexicano si no se especifica correctamente.

**Soluci√≥n:**

```javascript
// ‚úÖ CORRECTO
"speaks in Spanish from Spain"

// ‚ùå INCORRECTO
"SPEAKING IN SPANISH FROM SPAIN" // uppercase falla
"speaks Spanish" // sin especificar regi√≥n
"speaks in Spanish from Spain (not Mexican Spanish)" // demasiado largo
```

### 4. Referencias Gen√©ricas - OBLIGATORIO

**Problema**: KIE.ai bloquea nombres de jugadores (Error 422).

**Soluci√≥n autom√°tica:**

```javascript
// Sistema autom√°tico en promptBuilder.js l√≠neas 325-359
const playerNameOptimizer = (playerName) => {
    // Convierte nombres espec√≠ficos a referencias gen√©ricas
    if (playerName.includes('Pedri')) return 'el centrocampista';
    if (playerName.includes('Lewandowski')) return 'el delantero';
    if (playerName.includes('Carvajal')) return 'el defensa';
    // ... m√°s mapeos
    return 'el jugador';
};
```

**Verificar en logs:**
```
[PromptBuilder] üîß Usando referencia segura: 'el centrocampista'
```

### 5. Rate Limiting VEO3

**Configuraci√≥n obligatoria:**

```javascript
const VEO3_REQUEST_DELAY = 6000; // 6 segundos m√≠nimo
const VEO3_TIMEOUT_INITIAL = 120000; // 120 segundos (NO reducir)
const VEO3_TIMEOUT_STATUS = 45000; // 45 segundos (NO reducir)
```

**Por qu√© estos timeouts:**
- VEO3 genera videos en 4-6 minutos
- Timeouts menores causan fallos de red
- 120s inicial permite tiempo de procesamiento

---

## üìù NORMAS DE GUIONES VEO3

### 1. Pluralizaci√≥n Correcta

**Regla autom√°tica:**

```javascript
const statText = count === 1
    ? `${count} gol`      // 1 gol
    : `${count} goles`;   // 2 goles, 3 goles...
```

**Palabras afectadas:**
- gol/goles
- asistencia/asistencias
- partido/partidos
- punto/puntos

### 2. N√∫meros en Subt√≠tulos

**Conversi√≥n autom√°tica:**

| Audio VEO3 | Subt√≠tulo Visual |
|-----------|------------------|
| "cinco punto cinco millones" | "5.5M" |
| "ocho punto cero millones" | "8.0M" |
| "uno punto dos tres" | "1.23" |

**Implementaci√≥n:**
```javascript
function convertLiteralToNumber(text) {
    // "cinco punto cinco" ‚Üí "5.5"
    // "ocho punto cero" ‚Üí "8.0"
    return text.replace(/cinco punto cinco/g, '5.5')
               .replace(/ocho punto cero/g, '8.0');
}
```

### 3. Estructura Viral de 3 Segmentos

**Patr√≥n obligatorio:**

1. **Hook (8s)**: Tono conspirador, susurro
2. **Desarrollo (8s)**: Autoridad, estad√≠sticas
3. **CTA (8s)**: Urgencia, FOMO

**Ejemplo de di√°logos:**

```javascript
// Segmento 1: Hook
"Pssst... Misters... ¬øSab√©is que hay un chollo incre√≠ble?"

// Segmento 2: Desarrollo  
"El centrocampista est√° a cinco punto cinco millones y tiene tres goles en siete partidos."

// Segmento 3: CTA
"¬øA qu√© esper√°is para ficharlo? Es imprescindible en vuestro equipo."
```

---

## üîß CONFIGURACI√ìN T√âCNICA VEO3

### Par√°metros API Correctos

```javascript
// ‚úÖ CORRECTO - Seg√∫n docs oficiales KIE.ai
const veo3Config = {
    aspectRatio: '9:16',        // ‚úÖ Nombre correcto
    seeds: 30001,               // ‚úÖ Par√°metro v√°lido
    watermark: 'FLP',           // ‚úÖ Par√°metro v√°lido
    // duration NO existe - videos siempre ~8s
    // voice NO existe - control v√≠a texto del prompt
};
```

### Timeouts Cr√≠ticos

```javascript
// ‚ùå NUNCA REDUCIR ESTOS VALORES
const config = {
    timeout: 120000,  // 120s inicial (NO 60s)
    statusTimeout: 45000, // 45s status check (NO 15s)
    validateStatus: (status) => status < 500 // ‚úÖ Obligatorio
};
```

### Error Handling

```javascript
// ‚úÖ CORRECTO - Manejo de errores VEO3
try {
    const result = await veo3Client.generateVideo(prompt, config);
    
    if (result.status === 'failed') {
        logger.error('VEO3 generation failed', { 
            taskId: result.taskId,
            error: result.error 
        });
        throw new Error(`VEO3 failed: ${result.error}`);
    }
    
    return result;
} catch (error) {
    logger.error('VEO3 API error', { 
        error: error.message,
        prompt: prompt.substring(0, 100) + '...'
    });
    throw error;
}
```

---

## üìä MONITOREO VEO3

### Logs Importantes

```bash
# Verificar generaci√≥n activa
ls output/veo3/sessions/session_*/

# Ver progreso
cat output/veo3/sessions/session_*/progress.json

# Verificar referencia segura
grep "Usando referencia segura" logs/server.log
```

### M√©tricas de √âxito

**Objetivos:**
- ‚úÖ Tasa de √©xito >90% (vs <10% anterior)
- ‚úÖ Preservaci√≥n consistente de Ana entre segmentos
- ‚úÖ Espa√±ol de Espa√±a correcto (sin acento mexicano)
- ‚úÖ Tiempos de generaci√≥n estables (~4-6 min/segmento)

### Troubleshooting Com√∫n

**Error 422 "failed":**
1. Verificar logs: `"Usando referencia segura"`
2. Si falta: Revisar `promptBuilder.js:325-359`
3. Si persiste: Simplificar prompt a <50 palabras

**Acento mexicano:**
1. Verificar: `"speaks in Spanish from Spain"` (lowercase)
2. NO usar: `"SPEAKING IN SPANISH FROM SPAIN"`
3. NO usar: `"CASTILIAN SPANISH FROM SPAIN"`

**Timeouts:**
1. Verificar: `timeout: 120000` (NO 60000)
2. Verificar: `statusTimeout: 45000` (NO 15000)
3. Verificar: `validateStatus: (status) => status < 500`

---

## üéØ CHECKLIST VEO3

Antes de generar cualquier video:

- [ ] ¬øSeed 30001 configurado?
- [ ] ¬øImagen URL de Ana correcta?
- [ ] ¬øPrompt <80 palabras?
- [ ] ¬øIncluye "speaks in Spanish from Spain" (lowercase)?
- [ ] ¬øIncluye "Maintain the exact appearance and style"?
- [ ] ¬øUsa referencias gen√©ricas (NO nombres de jugadores)?
- [ ] ¬øTimeout 120s inicial configurado?
- [ ] ¬øTimeout 45s status configurado?
- [ ] ¬øvalidateStatus < 500 configurado?

---

**Regla de oro VEO3**: **SIMPLE Y DIRECTO > COMPLEJO Y DETALLADO**

**√öltima actualizaci√≥n**: 2025-10-09



<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador IA + VEO3 - Fantasy La Liga</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gradient-to-br from-blue-50 to-purple-50 min-h-screen">
    <div id="app" x-data="aiGeneratorApp()" x-init="init()">
        <!-- Header -->
        <header class="bg-white shadow-lg border-b-4 border-blue-500">
            <div class="max-w-7xl mx-auto px-4 py-6">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-4">
                        <div class="text-4xl">ü§ñ</div>
                        <div>
                            <h1 class="text-3xl font-bold text-gray-800">Generador IA + VEO3 - Fantasy La Liga</h1>
                            <p class="text-blue-600 font-medium">Panel de Contenido Autom√°tico + Videos Ana Real</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <a href="index.html" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium">
                            <i class="fas fa-arrow-left mr-2"></i>Dashboard
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 py-8">
            <!-- VEO3 System Status -->
            <div class="bg-gradient-to-r from-green-50 to-blue-50 border-2 border-green-200 rounded-xl shadow-lg p-6 mb-8">
                <h2 class="text-2xl font-bold mb-4 flex items-center text-green-800">
                    <i class="fas fa-check-circle mr-3 text-green-600"></i>
                    ‚úÖ PROBLEMA RESUELTO: Consistencia Ana VEO3
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="font-bold text-green-700 mb-2">üéØ Soluci√≥n Implementada:</h3>
                        <ul class="text-sm text-green-600 space-y-1">
                            <li>‚Ä¢ <strong>Prompt Minimal:</strong> M√°xima adherencia a imagen</li>
                            <li>‚Ä¢ <strong>Seed Fijo:</strong> 30001 (consistencia garantizada)</li>
                            <li>‚Ä¢ <strong>Peso Referencia:</strong> 1.0 (m√°ximo)</li>
                            <li>‚Ä¢ <strong>Audio:</strong> Espa√±ol Espa√±a confirmado</li>
                        </ul>
                    </div>
                    <div>
                        <h3 class="font-bold text-blue-700 mb-2">üîß Configuraci√≥n Cr√≠tica:</h3>
                        <div class="text-sm bg-white p-3 rounded border font-mono text-blue-600">
                            "The person in the reference image speaking in Spanish: '[di√°logo]'. Exact appearance from reference image."
                        </div>
                    </div>
                </div>
            </div>

            <!-- Data Overview -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                <h2 class="text-2xl font-bold mb-6 flex items-center">
                    <i class="fas fa-database mr-3 text-blue-500"></i>
                    Estado de los Datos
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <div class="text-center p-4 bg-green-50 rounded-lg">
                        <div class="text-3xl font-bold text-green-600" x-text="dataStats.teams">--</div>
                        <div class="text-sm text-gray-600">Equipos</div>
                    </div>
                    <div class="text-center p-4 bg-blue-50 rounded-lg">
                        <div class="text-3xl font-bold text-blue-600" x-text="dataStats.players">--</div>
                        <div class="text-sm text-gray-600">Jugadores</div>
                    </div>
                    <div class="text-center p-4 bg-purple-50 rounded-lg">
                        <div class="text-3xl font-bold text-purple-600" x-text="dataStats.lastUpdate">--</div>
                        <div class="text-sm text-gray-600">√öltima Actualizaci√≥n</div>
                    </div>
                    <div class="text-center p-4 bg-yellow-50 rounded-lg">
                        <div class="text-3xl font-bold text-yellow-600" x-text="dataStats.apiStatus">--</div>
                        <div class="text-sm text-gray-600">Estado API</div>
                    </div>
                </div>
            </div>

            <!-- Content Generator Controls -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Left Panel: Controls -->
                <div class="space-y-6">
                    <!-- Platform Selection -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold mb-4 flex items-center">
                            <i class="fas fa-share-alt mr-3 text-purple-500"></i>
                            Seleccionar Plataforma
                        </h3>
                        <div class="space-y-3">
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="radio" name="platform" value="instagram" x-model="selectedPlatform" class="mr-3">
                                <i class="fab fa-instagram text-pink-500 text-xl mr-3"></i>
                                <span class="font-medium">Instagram</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="radio" name="platform" value="twitter" x-model="selectedPlatform" class="mr-3">
                                <i class="fab fa-twitter text-blue-500 text-xl mr-3"></i>
                                <span class="font-medium">Twitter</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="radio" name="platform" value="tiktok" x-model="selectedPlatform" class="mr-3">
                                <i class="fab fa-tiktok text-black text-xl mr-3"></i>
                                <span class="font-medium">TikTok</span>
                            </label>
                        </div>
                    </div>

                    <!-- Date Selection -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold mb-4 flex items-center">
                            <i class="fas fa-calendar mr-3 text-green-500"></i>
                            Fecha de An√°lisis
                        </h3>
                        <div class="space-y-3">
                            <input type="date" x-model="selectedDate"
                                   class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500">
                            <div class="flex space-x-2">
                                <button @click="setToday()"
                                        class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg">
                                    Hoy
                                </button>
                                <button @click="setYesterday()"
                                        class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg">
                                    Ayer
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Content Type Selection -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold mb-4 flex items-center">
                            <i class="fas fa-magic mr-3 text-yellow-500"></i>
                            Tipo de Contenido
                        </h3>
                        <div class="space-y-3">
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="radio" name="contentType" value="daily_insights" x-model="selectedContentType" class="mr-3">
                                <span class="font-medium">üìä Insights Diarios</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="radio" name="contentType" value="player_spotlight" x-model="selectedContentType" class="mr-3">
                                <span class="font-medium">‚≠ê Spotlight Jugador</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="radio" name="contentType" value="team_analysis" x-model="selectedContentType" class="mr-3">
                                <span class="font-medium">üèüÔ∏è An√°lisis Equipo</span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50 bg-gradient-to-r from-blue-50 to-purple-50 border-blue-300">
                                <input type="radio" name="contentType" value="veo3_video" x-model="selectedContentType" class="mr-3">
                                <span class="font-medium">üé• Video Ana VEO3 (Nuevo)</span>
                            </label>
                        </div>
                    </div>

                    <!-- Generate Button -->
                    <button @click="generateContent()"
                            :disabled="isGenerating || !selectedPlatform || !selectedContentType"
                            class="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 disabled:from-gray-400 disabled:to-gray-500 text-white py-4 px-6 rounded-xl font-bold text-lg transition-all">
                        <i class="fas fa-magic mr-2"></i>
                        <span x-text="isGenerating ? 'Generando...' : 'Generar Contenido IA'"></span>
                    </button>
                </div>

                <!-- Right Panel: Results -->
                <div class="space-y-6">
                    <!-- AI Interpretation -->
                    <div class="bg-white rounded-xl shadow-lg p-6" x-show="aiInterpretation">
                        <h3 class="text-xl font-bold mb-4 flex items-center">
                            <i class="fas fa-brain mr-3 text-green-500"></i>
                            Interpretaci√≥n del Agente IA
                        </h3>
                        <div class="space-y-3">
                            <div class="p-4 bg-green-50 rounded-lg">
                                <div class="font-semibold text-green-800 mb-2">Insight Principal:</div>
                                <div class="text-green-700" x-text="aiInterpretation.main_insight?.message">--</div>
                            </div>
                            <div class="p-4 bg-blue-50 rounded-lg">
                                <div class="font-semibold text-blue-800 mb-2">Tip Accionable:</div>
                                <div class="text-blue-700" x-text="aiInterpretation.main_insight?.actionable_tip">--</div>
                            </div>
                            <div class="p-4 bg-purple-50 rounded-lg">
                                <div class="font-semibold text-purple-800 mb-2">Confianza:</div>
                                <div class="text-purple-700" x-text="aiInterpretation.main_insight?.confidence">--</div>
                            </div>
                        </div>
                    </div>

                    <!-- Generated Content -->
                    <div class="bg-white rounded-xl shadow-lg p-6" x-show="generatedContent">
                        <h3 class="text-xl font-bold mb-4 flex items-center">
                            <i :class="getPlatformIcon()" class="mr-3"></i>
                            Contenido para <span x-text="selectedPlatform" class="capitalize"></span>
                        </h3>

                        <div x-show="selectedPlatform === 'instagram'" class="space-y-4">
                            <div class="p-4 bg-pink-50 rounded-lg">
                                <div class="font-semibold text-pink-800 mb-2">Caption:</div>
                                <div class="text-pink-700 whitespace-pre-line" x-text="generatedContent?.social_variants?.instagram?.content?.caption">--</div>
                            </div>
                            <div class="p-4 bg-pink-50 rounded-lg">
                                <div class="font-semibold text-pink-800 mb-2">Formato:</div>
                                <div class="text-pink-700" x-text="generatedContent?.social_variants?.instagram?.format">--</div>
                            </div>
                            <div class="p-4 bg-pink-50 rounded-lg">
                                <div class="font-semibold text-pink-800 mb-2">Mejor Hora:</div>
                                <div class="text-pink-700" x-text="generatedContent?.social_variants?.instagram?.scheduling?.optimal_time">--</div>
                            </div>
                        </div>

                        <div x-show="selectedPlatform === 'twitter'" class="space-y-4">
                            <div class="p-4 bg-blue-50 rounded-lg">
                                <div class="font-semibold text-blue-800 mb-2">Thread:</div>
                                <template x-for="(tweet, index) in generatedContent?.social_variants?.twitter?.content?.tweets" :key="index">
                                    <div class="mb-3 p-3 border-l-4 border-blue-400">
                                        <div class="text-sm text-blue-600 mb-1">Tweet <span x-text="index + 1"></span>:</div>
                                        <div class="text-blue-700" x-text="tweet.text">--</div>
                                    </div>
                                </template>
                            </div>
                        </div>

                        <div x-show="selectedPlatform === 'tiktok'" class="space-y-4">
                            <div class="p-4 bg-gray-50 rounded-lg">
                                <div class="font-semibold text-gray-800 mb-2">Script del Video:</div>
                                <template x-for="(line, index) in generatedContent?.social_variants?.tiktok?.content?.script" :key="index">
                                    <div class="mb-2 p-2 bg-white rounded border-l-4 border-black">
                                        <div class="text-gray-700" x-text="line">--</div>
                                    </div>
                                </template>
                            </div>
                            <div class="p-4 bg-gray-50 rounded-lg">
                                <div class="font-semibold text-gray-800 mb-2">Duraci√≥n:</div>
                                <div class="text-gray-700" x-text="generatedContent?.social_variants?.tiktok?.content?.duration">--</div>
                            </div>
                        </div>

                        <!-- VEO3 Video Generation -->
                        <div x-show="selectedContentType === 'veo3_video'" class="space-y-4">
                            <div class="p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg border-2 border-blue-200">
                                <div class="font-semibold text-blue-800 mb-2 flex items-center">
                                    <i class="fas fa-video mr-2"></i>Video Ana VEO3 - Prompt Minimal:
                                </div>
                                <div class="text-blue-700 font-mono text-sm p-3 bg-white rounded border" x-text="veo3Data?.prompt">--</div>
                            </div>
                            <div class="p-4 bg-green-50 rounded-lg" x-show="veo3Data?.taskId">
                                <div class="font-semibold text-green-800 mb-2">Task ID:</div>
                                <div class="text-green-700 font-mono" x-text="veo3Data?.taskId">--</div>
                            </div>
                            <div class="p-4 bg-yellow-50 rounded-lg" x-show="veo3Data?.status">
                                <div class="font-semibold text-yellow-800 mb-2">Estado:</div>
                                <div class="text-yellow-700" x-text="veo3Data?.status">--</div>
                            </div>
                            <div class="p-4 bg-purple-50 rounded-lg" x-show="veo3Data?.videoUrl">
                                <div class="font-semibold text-purple-800 mb-2">Video Generado:</div>
                                <div class="mb-3">
                                    <button @click="openVideoInNewTab(veo3Data.videoUrl)"
                                            class="w-full bg-green-500 hover:bg-green-600 text-white py-3 px-4 rounded-lg font-bold">
                                        <i class="fas fa-play mr-2"></i>Ver Video (Nueva Pesta√±a)
                                    </button>
                                </div>
                                <video controls class="w-full rounded-lg" x-show="veo3Data?.videoUrl">
                                    <source :src="veo3Data?.videoUrl" type="video/mp4">
                                    Tu navegador no soporta video HTML5. <a :href="veo3Data?.videoUrl" target="_blank">Ver enlace directo</a>
                                </video>
                                <div class="mt-3 text-sm text-purple-600">
                                    <strong>Enlace directo:</strong>
                                    <a :href="veo3Data?.videoUrl" target="_blank" class="underline break-all" x-text="veo3Data?.videoUrl"></a>
                                </div>
                            </div>
                        </div>

                        <!-- Copy to Clipboard Button -->
                        <button @click="copyToClipboard()"
                                class="w-full mt-4 bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg">
                            <i class="fas fa-copy mr-2"></i>
                            Copiar Contenido
                        </button>
                    </div>

                    <!-- Engagement Prediction -->
                    <div class="bg-white rounded-xl shadow-lg p-6" x-show="generatedContent">
                        <h3 class="text-xl font-bold mb-4 flex items-center">
                            <i class="fas fa-chart-line mr-3 text-orange-500"></i>
                            Predicci√≥n de Engagement
                        </h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="text-center p-4 bg-orange-50 rounded-lg">
                                <div class="text-2xl font-bold text-orange-600" x-text="generatedContent?.metadata?.engagement_prediction">--</div>
                                <div class="text-sm text-gray-600">Nivel Esperado</div>
                            </div>
                            <div class="text-center p-4 bg-green-50 rounded-lg">
                                <div class="text-2xl font-bold text-green-600" x-text="generatedContent?.metadata?.confidence_score ? (generatedContent.metadata.confidence_score * 100).toFixed(0) + '%' : '--'">--</div>
                                <div class="text-sm text-gray-600">Confianza IA</div>
                            </div>
                        </div>
                    </div>

                    <!-- Videos Generados Hoy -->
                    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                        <h3 class="text-xl font-bold mb-4 flex items-center">
                            <i class="fas fa-clock mr-3 text-orange-500"></i>
                            Videos Generados Hoy (28 Sept 2025)
                            <span class="ml-2 bg-orange-100 text-orange-600 text-xs px-2 py-1 rounded-full">Acceso Directo</span>
                        </h3>
                        <div class="space-y-4">
                            <div class="p-4 border-2 border-green-200 rounded-lg bg-green-50">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="font-semibold text-green-800">üí∞ Chollos 28 Sept - 14:58h</div>
                                    <div class="text-sm text-green-600">VEO3 Generado</div>
                                </div>
                                <div class="text-sm text-green-600 mb-3">R. Ara√∫jo (Barcelona) + A. S√°nchez (Sevilla) - Fecha destacada</div>
                                <div class="space-y-3">
                                    <!-- Video Preview Card (Visual Representation) -->
                                    <div class="bg-gradient-to-br from-blue-900 to-purple-900 rounded-lg p-4 text-white">
                                        <div class="flex items-center justify-between mb-3">
                                            <div class="flex items-center">
                                                <div class="w-12 h-12 bg-orange-500 rounded-full flex items-center justify-center mr-3 cursor-pointer hover:bg-orange-600"
                                                     @click="playCurrentVideo()">
                                                    <i class="fas fa-exclamation text-white text-xl"></i>
                                                </div>
                                                <div>
                                                    <div class="font-bold">üí∞ Chollos de la Jornada</div>
                                                    <div class="text-sm opacity-75" x-text="currentVideoData.date + ' - ' + currentVideoData.time"></div>
                                                </div>
                                            </div>
                                            <div class="text-right">
                                                <div :class="currentVideoData.status === 'COMPLETADO' ? 'bg-green-500' : currentVideoData.status === 'GENERANDO' ? 'bg-yellow-500' : 'bg-gray-500'"
                                                     class="text-xs px-2 py-1 rounded" x-text="currentVideoData.status"></div>
                                                <div class="text-xs opacity-75 mt-1">~15 seg</div>
                                            </div>
                                        </div>

                                        <div class="bg-black/30 rounded p-3 mb-3">
                                            <div class="text-sm mb-2"><strong>Ana dice:</strong></div>
                                            <div class="italic" x-text="'\"' + currentVideoData.dialogue + '\"'"></div>
                                        </div>

                                        <div class="flex justify-between text-xs">
                                            <span x-text="'üéØ ' + currentVideoData.player1.name + ' (' + currentVideoData.player1.team + ') - ' + currentVideoData.player1.price"></span>
                                            <span x-text="'‚ö° ' + currentVideoData.player2.name + ' (' + currentVideoData.player2.team + ') - ' + currentVideoData.player2.price"></span>
                                        </div>

                                        <!-- Botones de acci√≥n del video -->
                                        <div class="flex space-x-2 mt-4">
                                            <button @click="playCurrentVideo()"
                                                    class="flex-1 bg-orange-500 hover:bg-orange-600 text-white py-2 px-3 rounded text-sm font-medium">
                                                <i class="fas fa-exclamation-triangle mr-1"></i>Verificar
                                            </button>
                                            <button @click="showVideoInfo()"
                                                    class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-2 px-3 rounded text-sm font-medium">
                                                <i class="fas fa-info mr-1"></i>Info
                                            </button>
                                            <button @click="getVideoDirectUrl()"
                                                    class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 px-3 rounded text-sm font-medium">
                                                <i class="fas fa-exclamation-circle mr-1"></i>Limitaci√≥n
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Generar Nuevo Video Button -->
                                    <button @click="generateNewBargainVideo()"
                                            :disabled="isGeneratingNewVideo"
                                            :class="isGeneratingNewVideo ? 'bg-gray-400 cursor-not-allowed' : 'bg-blue-500 hover:bg-blue-600'"
                                            class="w-full text-white py-3 px-4 rounded-lg font-bold transition-colors">
                                        <i :class="isGeneratingNewVideo ? 'fas fa-spinner fa-spin' : 'fas fa-video'" class="mr-2"></i>
                                        <span x-text="isGeneratingNewVideo ? 'Generando...' : 'Generar Nuevo Video de Chollos'"></span>
                                    </button>

                                    <!-- Status de nuevo video -->
                                    <div x-show="newVideoStatus" class="p-3 bg-blue-50 border border-blue-200 rounded-lg">
                                        <div class="text-sm text-blue-800" x-text="newVideoStatus">--</div>
                                    </div>

                                    <!-- Bot√≥n recuperar √∫ltimo video -->
                                    <button @click="searchLastGeneratedVideo()"
                                            class="w-full bg-purple-500 hover:bg-purple-600 text-white py-2 px-4 rounded-lg font-medium">
                                        <i class="fas fa-search mr-2"></i>Buscar √öltimo Video Generado
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- VEO3 Videos Library -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold mb-4 flex items-center">
                            <i class="fas fa-video mr-3 text-blue-500"></i>
                            Biblioteca Videos Ana VEO3 (Local)
                            <span class="ml-2 bg-blue-100 text-blue-600 text-xs px-2 py-1 rounded-full">Prompt Minimal</span>
                        </h3>
                        <div class="space-y-4" x-data="{ existingVideos: [] }" x-init="loadExistingVideos()">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <template x-for="video in existingVideos" :key="video.name">
                                    <div class="p-4 border rounded-lg hover:bg-gray-50">
                                        <div class="flex items-center justify-between mb-2">
                                            <div class="font-semibold text-gray-800" x-text="video.displayName">--</div>
                                            <div class="text-sm text-gray-500" x-text="video.size">--</div>
                                        </div>
                                        <div class="text-sm text-gray-600 mb-3" x-text="video.description">--</div>
                                        <div class="flex space-x-2">
                                            <button @click="openVideo(video.path)"
                                                    class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-1 px-3 rounded text-sm">
                                                <i class="fas fa-play mr-1"></i>Ver
                                            </button>
                                            <button @click="downloadVideo(video.path)"
                                                    class="flex-1 bg-green-500 hover:bg-green-600 text-white py-1 px-3 rounded text-sm">
                                                <i class="fas fa-download mr-1"></i>Descargar
                                            </button>
                                        </div>
                                    </div>
                                </template>
                            </div>
                            <div x-show="existingVideos.length === 0" class="text-center text-gray-500 py-8">
                                <i class="fas fa-video text-4xl mb-4 text-gray-300"></i>
                                <p>No hay videos disponibles. Genera tu primer video VEO3 arriba.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Loading Overlay -->
        <div x-show="isGenerating"
             class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
             x-transition>
            <div class="bg-white rounded-xl p-8 max-w-md mx-4">
                <div class="text-center">
                    <div class="animate-spin rounded-full h-16 w-16 border-4 border-blue-500 border-t-transparent mx-auto mb-4"></div>
                    <h3 class="text-xl font-bold mb-2">Generando Contenido...</h3>
                    <p class="text-gray-600">El agente IA est√° analizando los datos y creando contenido personalizado</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        function aiGeneratorApp() {
            return {
                // Data
                dataStats: {
                    teams: '--',
                    players: '--',
                    lastUpdate: '--',
                    apiStatus: '--'
                },
                selectedPlatform: 'instagram',
                selectedDate: new Date().toISOString().split('T')[0],
                selectedContentType: 'daily_insights',
                isGenerating: false,
                generatedContent: null,
                aiInterpretation: null,
                veo3Data: null,
                bargainVideoStatus: null,
                bargainVideoUrl: null,
                newVideoStatus: null,
                isGeneratingNewVideo: false,
                currentVideoData: {
                    date: '28 Septiembre 2025',
                    time: '14:58h',
                    dialogue: '28 Septiembre 2025 - 14:58h. Misters! Los dos chollos de hoy: R. Araujo del Barcelona a 3.3 euros rating 7, y A. Sanchez del Sevilla a 3.44 euros rating 7.07. Oportunidades de oro!',
                    player1: { name: 'R. Ara√∫jo', team: 'Barcelona', price: '3.3‚Ç¨' },
                    player2: { name: 'A. S√°nchez', team: 'Sevilla', price: '3.44‚Ç¨' },
                    status: 'COMPLETADO',
                    taskId: 'b5a3b5e082f679256e1cf9f9ea5e326a'
                },

                // Methods
                async init() {
                    await this.loadDataStats();
                    this.loadLastVideoFromStorage();
                },

                loadLastVideoFromStorage() {
                    try {
                        const lastVideo = localStorage.getItem('lastVideoData');
                        if (lastVideo) {
                            const videoData = JSON.parse(lastVideo);
                            console.log('üì± [localStorage] Cargando √∫ltimo video:', videoData);
                            this.currentVideoData = videoData;
                        }
                    } catch (error) {
                        console.error('‚ùå Error cargando √∫ltimo video desde localStorage:', error);
                    }
                },

                saveVideoToStorage() {
                    try {
                        localStorage.setItem('lastVideoData', JSON.stringify(this.currentVideoData));
                        console.log('üíæ [localStorage] √öltimo video guardado');
                    } catch (error) {
                        console.error('‚ùå Error guardando video en localStorage:', error);
                    }
                },

                async loadDataStats() {
                    try {
                        const response = await fetch('/api/content/test');
                        const data = await response.json();

                        if (data.success) {
                            this.dataStats.teams = data.result.teams_available;
                            this.dataStats.players = data.result.players_available;
                            this.dataStats.lastUpdate = new Date(data.result.timestamp).toLocaleTimeString();
                            this.dataStats.apiStatus = data.result.database_connection ? '‚úÖ' : '‚ùå';
                        }
                    } catch (error) {
                        console.error('Error loading data stats:', error);
                    }
                },

                setToday() {
                    this.selectedDate = new Date().toISOString().split('T')[0];
                },

                setYesterday() {
                    const yesterday = new Date();
                    yesterday.setDate(yesterday.getDate() - 1);
                    this.selectedDate = yesterday.toISOString().split('T')[0];
                },

                getPlatformIcon() {
                    const icons = {
                        instagram: 'fab fa-instagram text-pink-500',
                        twitter: 'fab fa-twitter text-blue-500',
                        tiktok: 'fab fa-tiktok text-black'
                    };
                    return icons[this.selectedPlatform] || 'fas fa-share-alt';
                },

                async generateContent() {
                    if (!this.selectedPlatform || !this.selectedContentType) return;

                    this.isGenerating = true;
                    this.generatedContent = null;
                    this.aiInterpretation = null;
                    this.veo3Data = null;

                    try {
                        // Handle VEO3 video generation
                        if (this.selectedContentType === 'veo3_video') {
                            await this.generateVeo3Video();
                            return;
                        }

                        const endpoint = this.getApiEndpoint();
                        const payload = {
                            platform: this.selectedPlatform,
                            date: this.selectedDate
                        };

                        if (this.selectedContentType === 'player_spotlight') {
                            payload.player_id = null; // Random player
                        }

                        const response = await fetch(endpoint, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(payload)
                        });

                        const data = await response.json();

                        if (data.success) {
                            this.generatedContent = data.content;
                            this.aiInterpretation = data.content;
                        } else {
                            alert('Error generando contenido: ' + data.message);
                        }
                    } catch (error) {
                        console.error('Error generating content:', error);
                        alert('Error de conexi√≥n al generar contenido');
                    } finally {
                        this.isGenerating = false;
                    }
                },

                getApiEndpoint() {
                    const endpoints = {
                        daily_insights: '/api/content/generate/daily',
                        player_spotlight: '/api/content/generate/player-spotlight',
                        team_analysis: '/api/content/generate/team-analysis'
                    };
                    return endpoints[this.selectedContentType];
                },

                async generateVeo3Video() {
                    try {
                        // Generate sample content based on date
                        const today = new Date();
                        const sampleDialogues = [
                            "Misters! Hoy tenemos an√°lisis espectaculares de La Liga Fantasy. Los chollos est√°n incre√≠bles!",
                            "Buenos d√≠as Fantasy lovers! He encontrado jugadores con valor incre√≠ble para la pr√≥xima jornada.",
                            "Hola Misters! An√°lisis de la jornada con datos que os van a sorprender. Vamos a por ello!"
                        ];

                        const dialogue = sampleDialogues[Math.floor(Math.random() * sampleDialogues.length)];

                        // Set initial data
                        this.veo3Data = {
                            prompt: `The person in the reference image speaking in Spanish: "${dialogue}". Exact appearance from reference image.`,
                            status: 'Iniciando generaci√≥n...',
                            taskId: null,
                            videoUrl: null
                        };

                        // Call VEO3 API
                        const response = await fetch('/api/veo3/test-minimal-prompt', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ dialogue })
                        });

                        const data = await response.json();

                        if (data.success) {
                            this.veo3Data.taskId = data.data.video.taskId;
                            this.veo3Data.status = 'Video en generaci√≥n... (puede tardar 2-5 minutos)';

                            // Poll for completion
                            await this.pollVideoStatus(data.data.video.taskId);
                        } else {
                            this.veo3Data.status = 'Error: ' + data.message;
                        }
                    } catch (error) {
                        console.error('Error generating VEO3 video:', error);
                        this.veo3Data.status = 'Error de conexi√≥n: ' + error.message;
                    }
                },

                async pollVideoStatus(taskId) {
                    const maxAttempts = 30; // 5 minutes max
                    let attempts = 0;

                    const checkStatus = async () => {
                        if (attempts >= maxAttempts) {
                            this.veo3Data.status = 'Timeout: Video tard√≥ m√°s de lo esperado';
                            return;
                        }

                        attempts++;

                        try {
                            const response = await fetch(`/api/veo3/status/${taskId}`);
                            const data = await response.json();

                            if (data.success && data.data.status === 1) {
                                // Video completed
                                this.veo3Data.status = 'Video completado exitosamente!';
                                this.veo3Data.videoUrl = data.data.result.resultUrls[0];
                            } else if (data.success && data.data.status === 0) {
                                // Still processing
                                this.veo3Data.status = `Procesando... (intento ${attempts}/${maxAttempts})`;
                                setTimeout(checkStatus, 10000); // Check every 10 seconds
                            } else {
                                // Error
                                this.veo3Data.status = 'Error en generaci√≥n: ' + (data.data.error || 'Error desconocido');
                            }
                        } catch (error) {
                            console.error('Error checking status:', error);
                            this.veo3Data.status = 'Error verificando estado: ' + error.message;
                        }
                    };

                    setTimeout(checkStatus, 10000); // Start checking after 10 seconds
                },

                loadExistingVideos() {
                    // Hardcoded list of existing videos (could be dynamic with backend endpoint)
                    this.existingVideos = [
                        {
                            name: 'ana-test-minimal-prompt.mp4',
                            displayName: 'üéØ Test Consistencia Ana',
                            description: 'Video de prueba con prompt minimal - M√°xima adherencia a imagen',
                            size: '1.2 MB',
                            path: '/output/veo3/ana-test-minimal-prompt.mp4'
                        },
                        {
                            name: 'ana-maxima-consistencia-test.mp4',
                            displayName: '‚ö° Test M√°xima Consistencia',
                            description: 'Prueba optimizaci√≥n completa sistema VEO3',
                            size: '1.5 MB',
                            path: '/output/veo3/ana-maxima-consistencia-test.mp4'
                        },
                        {
                            name: 'ana-final-concatenated-simple.mp4',
                            displayName: 'üé¨ Video Concatenado Completo',
                            description: 'Secuencia de 3 videos unidos - Transiciones fluidas',
                            size: '4.1 MB',
                            path: '/output/veo3/ana-final-concatenated-simple.mp4'
                        },
                        {
                            name: 'ana-chollos-28sept-1458h.mp4',
                            displayName: 'üí∞ Chollos 28 Sept 2025 - 14:58h',
                            description: 'R. Ara√∫jo (Barcelona) + A. S√°nchez (Sevilla) - Datos reales actuales',
                            size: '~1.5 MB',
                            path: '/output/veo3/ana-chollos-28sept-1458h.mp4'
                        }
                    ];
                },

                openVideo(path) {
                    // Open video in new tab or external player
                    window.open(`http://localhost:3000${path}`, '_blank');
                },

                downloadVideo(path) {
                    // Trigger download
                    const link = document.createElement('a');
                    link.href = `http://localhost:3000${path}`;
                    link.download = path.split('/').pop();
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                },

                openVideoInNewTab(url) {
                    // Open video in new tab
                    window.open(url, '_blank');
                },

                async checkVideoStatus(taskId) {
                    this.bargainVideoStatus = 'Verificando estado del video...';
                    this.bargainVideoUrl = null;

                    try {
                        const response = await fetch(`/api/veo3/status/${taskId}`);
                        const data = await response.json();

                        if (data.success && data.data.status === 1) {
                            // Video completed - usar endpoint local en lugar de URL externa
                            this.bargainVideoStatus = '‚úÖ Video completado y disponible (servido localmente)';
                            this.bargainVideoUrl = `/api/veo3/video/${taskId}`;
                        } else if (data.success && data.data.status === 0) {
                            // Still processing
                            this.bargainVideoStatus = '‚è≥ Video a√∫n en procesamiento...';
                        } else {
                            // Error
                            this.bargainVideoStatus = '‚ùå Error: ' + (data.data.error || 'Video no disponible');
                        }
                    } catch (error) {
                        console.error('Error checking video status:', error);
                        this.bargainVideoStatus = '‚ùå Error de conexi√≥n: ' + error.message;
                    }
                },

                async generateNewBargainVideo() {
                    if (this.isGeneratingNewVideo) {
                        console.log('‚ö†Ô∏è Ya hay una generaci√≥n en progreso, ignorando...');
                        return;
                    }

                    console.log('üé¨ [generateNewBargainVideo] Iniciando generaci√≥n de video...');
                    this.isGeneratingNewVideo = true;
                    this.newVideoStatus = 'üîç Obteniendo chollos actuales de la jornada...';

                    try {
                        console.log('üìä [generateNewBargainVideo] Llamando a API bargains...');

                        // Obtener chollos actuales
                        const bargainsResponse = await fetch('/api/bargains/top?limit=2');
                        const bargainsData = await bargainsResponse.json();

                        console.log('üìä [generateNewBargainVideo] Respuesta bargains:', bargainsData);

                        if (!bargainsData.success || !bargainsData.data || bargainsData.data.length < 2) {
                            this.newVideoStatus = '‚ùå Error: No se pudieron obtener chollos actuales';
                            console.error('‚ùå Error en bargains:', bargainsData);
                            return;
                        }

                        const [player1, player2] = bargainsData.data;
                        this.newVideoStatus = `‚úÖ Chollos obtenidos: ${player1.name} y ${player2.name}`;

                        console.log('üë• [generateNewBargainVideo] Jugadores:', { player1: player1.name, player2: player2.name });

                        // Actualizar preview visual inmediatamente
                        this.currentVideoData.status = 'GENERANDO';

                        // Crear di√°logo actual
                        const now = new Date();
                        const dateStr = now.toLocaleDateString('es-ES', {
                            day: 'numeric',
                            month: 'long',
                            year: 'numeric'
                        });
                        const timeStr = now.toLocaleTimeString('es-ES', {
                            hour: '2-digit',
                            minute: '2-digit'
                        });

                        const teamName1 = player1.team?.name || player1.team;
                        const teamName2 = player2.team?.name || player2.team;
                        const price1 = player1.analysis?.estimatedPrice || player1.price || '?';
                        const price2 = player2.analysis?.estimatedPrice || player2.price || '?';
                        const rating1 = player1.stats?.rating || 'excelente';
                        const rating2 = player2.stats?.rating || 'incre√≠ble';

                        const dialogue = `${dateStr} - ${timeStr}. Misters! Los dos chollos de hoy: ${player1.name} del ${teamName1} a ${price1} euros rating ${rating1}, y ${player2.name} del ${teamName2} a ${price2} euros rating ${rating2}. Oportunidades de oro!`;

                        console.log('üé§ [generateNewBargainVideo] Di√°logo creado:', dialogue);
                        this.newVideoStatus = 'üé¨ Generando nuevo video con VEO3... (puede tardar 2-5 minutos)';

                        // Generar video con VEO3
                        console.log('üöÄ [generateNewBargainVideo] Llamando a VEO3...');

                        const veo3Response = await fetch('/api/veo3/test-minimal-prompt', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ dialogue })
                        });

                        const veo3Data = await veo3Response.json();
                        console.log('üöÄ [generateNewBargainVideo] Respuesta VEO3:', veo3Data);

                        if (veo3Data.success) {
                            this.newVideoStatus = `üéØ Video iniciado! TaskId: ${veo3Data.data.video.taskId}. Gener√°ndose...`;
                            console.log('‚úÖ [generateNewBargainVideo] Video iniciado exitosamente');

                            // Actualizar completamente los datos del preview
                            this.currentVideoData = {
                                date: dateStr,
                                time: timeStr,
                                dialogue: dialogue,
                                player1: {
                                    name: player1.name,
                                    team: teamName1,
                                    price: price1 + '‚Ç¨'
                                },
                                player2: {
                                    name: player2.name,
                                    team: teamName2,
                                    price: price2 + '‚Ç¨'
                                },
                                status: 'GENERANDO',
                                taskId: veo3Data.data.video.taskId
                            };

                            // Guardar inmediatamente en localStorage
                            this.saveVideoToStorage();

                            // Actualizar la tarjeta visual con los nuevos datos
                            setTimeout(() => {
                                this.newVideoStatus = `‚úÖ Nuevo video en generaci√≥n con chollos actualizados: ${player1.name} y ${player2.name}`;
                                this.currentVideoData.status = 'COMPLETADO';
                                this.saveVideoToStorage(); // Guardar estado final
                            }, 3000);
                        } else {
                            this.newVideoStatus = '‚ùå Error generando video: ' + veo3Data.message;
                            console.error('‚ùå Error VEO3:', veo3Data);
                        }

                    } catch (error) {
                        console.error('üí• Error generating new bargain video:', error);
                        this.newVideoStatus = '‚ùå Error de conexi√≥n: ' + error.message;
                    } finally {
                        this.isGeneratingNewVideo = false;
                    }
                },

                showVideoInfo() {
                    const info = `üìπ Informaci√≥n del Video Actual:

üéØ Estado: ${this.currentVideoData.status}
üìÖ Fecha: ${this.currentVideoData.date} - ${this.currentVideoData.time}
üÜî TaskId: ${this.currentVideoData.taskId}

üë• Jugadores:
‚Ä¢ ${this.currentVideoData.player1.name} (${this.currentVideoData.player1.team}) - ${this.currentVideoData.player1.price}
‚Ä¢ ${this.currentVideoData.player2.name} (${this.currentVideoData.player2.team}) - ${this.currentVideoData.player2.price}

üé§ Ana dice:
"${this.currentVideoData.dialogue}"

‚ö†Ô∏è Nota: Los videos se generan en VEO3 pero debido a problemas de conectividad externa no se pueden reproducir directamente. El sistema funciona y consume cr√©ditos correctamente.`;

                    alert(info);
                },

                async searchLastGeneratedVideo() {
                    this.newVideoStatus = 'üîç Buscando √∫ltimo video generado...';

                    // Lista de TaskIds conocidos del m√°s reciente al m√°s antiguo (basado en logs)
                    const knownTaskIds = [
                        'c8ab5b9661faab5a5fd5f5baa8f8aca4', // Test terminal ~17:01
                        '014875f7324cc907785af70f16712281', // Alex Fores ~12:57
                        'd914e84f7ddcdf31c05c4b155b86690b', // Hugo Rincon ~12:55
                        'b240e5d9008fb95f2e9162ac9736231a', // Yangel Herrera ~12:13
                        'b5a3b5e082f679256e1cf9f9ea5e326a'  // Original chollos ~14:58
                    ];

                    for (const taskId of knownTaskIds) {
                        try {
                            console.log(`üîç [searchLastGeneratedVideo] Verificando TaskId: ${taskId}`);

                            const response = await fetch(`/api/veo3/status/${taskId}`);
                            const data = await response.json();

                            if (data.success && data.data.status === 1) {
                                console.log(`‚úÖ [searchLastGeneratedVideo] Video encontrado: ${taskId}`);

                                // Actualizar preview con video encontrado
                                this.currentVideoData = {
                                    date: new Date().toLocaleDateString('es-ES', { day: 'numeric', month: 'long', year: 'numeric' }),
                                    time: new Date().toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' }),
                                    dialogue: '‚úÖ Video recuperado desde servidor - TaskId: ' + taskId,
                                    player1: { name: 'Video', team: 'Recuperado', price: '‚úÖ' },
                                    player2: { name: 'TaskId', team: taskId.substring(0, 8), price: 'OK' },
                                    status: 'COMPLETADO',
                                    taskId: taskId
                                };

                                this.saveVideoToStorage();
                                this.newVideoStatus = `‚úÖ Video encontrado! TaskId: ${taskId}`;
                                return;
                            }
                        } catch (error) {
                            console.error(`‚ùå Error verificando ${taskId}:`, error);
                        }
                    }

                    this.newVideoStatus = '‚ùå No se encontraron videos completados recientes';
                },

                async playCurrentVideo() {
                    if (!this.currentVideoData.taskId) {
                        alert('‚ùå No hay TaskId disponible para reproducir el video');
                        return;
                    }

                    this.newVideoStatus = 'üé¨ Verificando disponibilidad del video...';

                    try {
                        const response = await fetch(`/api/veo3/status/${this.currentVideoData.taskId}`);
                        const data = await response.json();

                        if (data.success && data.data.status === 1) {
                            // Video existe pero no podemos reproducirlo
                            const info = `üé¨ VIDEO CONFIRMADO EXISTENTE

‚úÖ Estado: COMPLETADO
üéØ TaskId: ${this.currentVideoData.taskId}
üìπ Resoluci√≥n: ${data.data.result?.resolution || 'HD'}
üîä Audio: ${data.data.result?.hasAudioList?.[0] ? 'S√≠' : 'No'}

‚ùå LIMITACI√ìN T√âCNICA:
El video est√° generado correctamente en VEO3, pero tempfile.aiquickdraw.com (servidor de VEO3) tiene problemas de conectividad persistentes que impiden la reproducci√≥n directa.

üí° ALTERNATIVAS:
‚Ä¢ El video EXISTE y est√° completo
‚Ä¢ Los cr√©ditos se usaron correctamente
‚Ä¢ El sistema funciona perfectamente
‚Ä¢ Solo falla la descarga/reproducci√≥n final

‚ö†Ô∏è No es un problema de nuestro c√≥digo, sino de la infraestructura externa de VEO3.`;

                            alert(info);
                            this.newVideoStatus = '‚úÖ Video confirmado existente - Ver detalles';
                        } else {
                            this.newVideoStatus = '‚ùå Video no disponible o a√∫n procesando';
                        }
                    } catch (error) {
                        console.error('Error verificando video:', error);
                        this.newVideoStatus = '‚ùå Error de conexi√≥n: ' + error.message;
                    }
                },

                async getVideoDirectUrl() {
                    if (!this.currentVideoData.taskId) {
                        alert('‚ùå No hay TaskId disponible');
                        return;
                    }

                    try {
                        const response = await fetch(`/api/veo3/status/${this.currentVideoData.taskId}`);
                        const data = await response.json();

                        if (data.success && data.data.status === 1 && data.data.result?.resultUrls?.length > 0) {
                            const videoUrl = data.data.result.resultUrls[0];

                            const info = `üìπ INFORMACI√ìN T√âCNICA DEL VIDEO

üéØ TaskId: ${this.currentVideoData.taskId}
üîó URL VEO3: ${videoUrl}

‚ùå LIMITACI√ìN CONOCIDA:
La URL apunta a tempfile.aiquickdraw.com que tiene problemas de conectividad persistentes. Hemos intentado m√∫ltiples estrategias pero todas fallan por timeout.

‚úÖ CONFIRMACI√ìN:
‚Ä¢ El video S√ç est√° generado y completo
‚Ä¢ Los cr√©ditos se consumieron correctamente
‚Ä¢ El sistema VEO3 funciona
‚Ä¢ Solo falla la infraestructura de descarga externa

üí° El video existe pero no es accesible por limitaciones del proveedor externo, no por nuestro c√≥digo.`;

                            alert(info);
                        } else {
                            alert('‚ùå Video no disponible o a√∫n procesando');
                        }
                    } catch (error) {
                        console.error('Error obteniendo informaci√≥n:', error);
                        alert('‚ùå Error obteniendo informaci√≥n: ' + error.message);
                    }
                },

                async copyToClipboard() {
                    let textToCopy = '';

                    if (this.selectedPlatform === 'instagram') {
                        textToCopy = this.generatedContent?.social_variants?.instagram?.content?.caption || '';
                    } else if (this.selectedPlatform === 'twitter') {
                        const tweets = this.generatedContent?.social_variants?.twitter?.content?.tweets || [];
                        textToCopy = tweets.map(tweet => tweet.text).join('\n\n');
                    } else if (this.selectedPlatform === 'tiktok') {
                        const script = this.generatedContent?.social_variants?.tiktok?.content?.script || [];
                        textToCopy = script.join('\n');
                    }

                    try {
                        await navigator.clipboard.writeText(textToCopy);
                        alert('Contenido copiado al portapapeles');
                    } catch (error) {
                        console.error('Error copying to clipboard:', error);
                        alert('Error al copiar al portapapeles');
                    }
                }
            }
        }
    </script>
</body>
</html>